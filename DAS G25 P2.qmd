---
title: "How to classify an eamil as spam"
author: "Group 25: Hang Cheng, Haowei Yan, Weijan Li, Wenli Lyu, Zehao Wang"
number-sections: true
format:
  pdf: default
  html:
    embed-resources: true
    code-tools: true
editor_options: 
  chunk_output_type: inline
execute:
  echo: true
  eval: true
  warning: false
  message: false
geometry: margin=1in,landscape
header-includes:
  - \usepackage{float}
  - \floatplacement{figure}{H}
  - \floatplacement{table}{H}
---

# Introductions

Spam has caused some distress in people's daily life, so identifying spam correctly becomes more and more important nowadays. This study aims to finding Which text characteristics influence whether an email will be classified as spam or not by analyzing the data shared with the UCI Machine Learning Repository.

# Data Reading {#sec-DR}

```{r}
#| label: libraries
# Load the necessary package
library(tidyverse)
library(moderndive)
library(gapminder)
library(sjPlot)
library(stats)
library(jtools)
library(skimr)

```

```{r}
#| label: data
# Read CSV data
d25 <- read.csv("dataset25.csv")
library(ggplot2)

```

## Summary of the Data

```{r}
#| tbl-cap: Summary of the Data
#| tbl-latex-options: [H]
d25 %>% skim()


```

```{r}
d25.spam <- d25 %>%
  select(yesno,crl.tot,dollar,bang,money,n000,make)
d25.spam$yesno <- as.factor(d25.spam$yesno)
```

## Data Visualization

```{r}
#| fig-cap: Data Visualization 
d25.spam %>%
  pivot_longer(cols = c(crl.tot, dollar, bang, money, n000, make), names_to = "variable", values_to = "value") %>%
  ggplot(aes(x = value)) +
  geom_histogram(bins = 30, fill = "blue", alpha = 0.5) +
  facet_wrap(~variable, scales = "free") +
  theme_minimal()
```

```{r}
d25.spam %>%
  pivot_longer(cols = c(crl.tot, dollar, bang, money, n000, make), , names_to = "variable", values_to = "value") %>%
  ggplot(aes(x = value, fill = yesno)) +
  geom_density(alpha = 0.5) +
  facet_wrap(~variable, scales = "free") +
  theme_minimal()
```

```{r}
d25.spam %>%
  pivot_longer(cols = c(crl.tot, dollar, bang, money, n000, make), , names_to = "variable", values_to = "value") %>%
  ggplot(aes(x = yesno, y = value, fill = yesno)) +
  geom_boxplot() +
  facet_wrap(~variable, scales = "free") +
  theme_minimal()


```

## Data Transform

```{r}
#| label: selection
d25.spam <- d25.spam %>%
  mutate(across(c(crl.tot, dollar, bang, money, n000, make), scale))

```

According to the data, six main characteristics may exert an influence on classifying an email as spam.


# Regression Results of the Data by using Generalized Linear Models

```{r}
#| tbl-cap: Summary Statistics for the GLM.
#| tbl-latex-options: [H]
model.spam <- glm(yesno ~ crl.tot + dollar + bang + money + n000 + make, data = d25.spam, family = binomial(link = "logit"))

model.spam %>%
  summary()
```

The coefficients of six characteristics are all positive, suggesting that spam tends to have more of these text characteristics. All the coefficients of the characteristics, except 'make', are significant because of the low p-values. Then we can obtain the effect of these characteristics by looking at the exponential values.

# Residual Analysis

```{r}
d25.spam$residuals <- residuals(model.spam, type = "deviance")

ggplot(d25.spam, aes(x = residuals)) +
  geom_histogram(binwidth = 0.5, fill = "blue", alpha = 0.6) +
  labs(title = "Residual Analysis", x = "Residual", y = "Frequency") +
  theme_minimal()


```

This residual analysis plot shows the residual is skewed distribution, it may not completely follow the normal distribution. This means that the model has systematic errors in some intervals.

```{r}
ggplot(d25.spam, aes(x = fitted(model.spam), y = residuals)) +
  geom_point(alpha = 0.5) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "red") +
  labs(title = "Fitted value vs. Residual", x = "Fitted value", y = "Residual") +
  theme_minimal()
```

This plot indicates that the residual are not randomly distributed, but show a systematic trend. Meanwhile, this plot means that the model has larger prediction errors for certain ranges, which may affect the reliability of the confidence interval.

# Data Summary

```{r}
#| fig.cap: Odds of classifying emails as spam
#| fig-latex-options: [H]
plot_model(model.spam, show.values = TRUE, title = "Odds", show.p = FALSE, value.offset = 0.25)
```

According to the graph, when we look at a ten-characters length difference of uninterrupted sequences of capitals between two emails, the one having more uninterrupted sequences of capitals is 1.01 times more likely to be classified as spam than the one with less uninterrupted sequences of capitals. Also, with one unit increase in the occurences of dollar sign, exclamation mark, character 'money', string '000' and character 'make', the higher one's odds of be classified as spam are 1054.12 times, 2.08 times, 33.73 times, 245.92 times and 1.01 times than those of the lower one respectively.

# Conclusions
